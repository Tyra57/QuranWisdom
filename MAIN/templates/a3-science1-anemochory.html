{% extends 'base.html' %}
{% load static %}
  {% block title %}
    <title>Anemochory</title>
    <link rel="stylesheet" href="{% static 'css\main.css' %}">
    <link rel="stylesheet" href="{% static 'css\nav.css' %}">
    <link rel="stylesheet" href="{% static 'css\scroll.css' %}">
    <link rel="stylesheet" href="{% static 'css\forum.css' %}">
    <link rel="stylesheet" href="{% static 'css\sciencescontent.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
      #languageMenu {
        display: inline;
        font-size: 15px;
        padding: 11px 5px;
        border: 1px solid #38444d;
        cursor: pointer;
        background: #dddddd4f;
        color: #38444d;
        font-family: 'poppins', sans-serif;
      }
      #languageMenu:hover {
        background: #38444d;
        color: #fff;
      }
      #languageMenu:focus {
        outline: none;
      }
      .nav-to-right i{
    color: #38444d;
  }
  .nav-to-right button:hover{
    color: #fff;
    background: #38444d;
    border: 1px solid #7d95a7;
    cursor: pointer;
  }
  .nav-to-right button:hover>i{
    color: #fff;  
  }
  .nav-to-right p:hover > i{
    color: #fff; 
  }
  .sciences img{
    width: 600px;
    height: 400px;
  }
  .sciences{ 
    padding: 50px 150px 50px 150px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: justify;
  }
  .reference{
    display: flex;
    flex-direction: column;
    padding: 0px 100px 100px 150px;
  }
  .sciences h1{
    margin-bottom: 10px;
    text-align: center;
  }

  .reference h4{
    color:#555;
  }
  
  .reference p{
    font-weight: 300;
  }

      @media screen and (max-width: 768px) {
    .nav-to-right, .nav-line{
      margin-left: 20px;
    }
    .nav-link{
      margin-left: 20px;
      margin-right: 0;
    }
    .sciences{
      padding: 50px 20px 50px 20px;
    }
    .sciences img{
      width: 300px;
      height: 200px;
    }
    .reference{
      padding: 0px 20px 100px 20px;
    }
  }
</style>
{% endblock title %}
{% block content %}   
<!--nav link-->
<div class="nav-link">
  <div class="nav-link-content">
    <a href="{% url 'home' %}"><i class="fa-solid fa-house"></i></a>
    <i class="fa-solid fa-chevron-right"></i>
    <p> <a href="{% url 'science' %}"> Sciences </a><span><i class="fa-solid fa-chevron-right"></i></span> Anemochory</p>
  </div> 
</div>
<hr class ="nav-line">
<br>
<!--bookmark and comment-->
<div class="nav-to-right">
  <div class="nav-to-right-content">
    <p><i class="fa-regular fa-bookmark fa-2x" onclick="toggleBookmark(this, 'Science-Anemochory')" data-slug="Science-Anemochory"></i></p>
    <button onclick="on()">See Discussion <i class="fa-regular fa-comment"></i></button>
    {{languageMenu|safe}}
  </div>
</div>

<!--Forum Section-->
<div class="overlay" id="overlay">
  <div class="container">
      <div class="close">
          <div class="close-button">
              <i class="fas fa-times" onclick="off()"></i>
          </div>         
          <div class="subforum">

          {% if user.is_authenticated %}
            <div class ="create-post">
              <button style="color:#38444d"><a href="{% url 'create_post' %}">Create Post</a></button>
            </div>
          {% endif %}

          <div class="subforum-title">
              <h1>Forum</h1>
          </div>

          {% for forum in forums %}
          <div class="subforum-row">
              <!--<div class="subforum-icon subforum-column center">
                  <i class="fas fa-user"></i>
              </div>-->
              <div class="subforum-description subforum-column">
                  <h1><a href="{{forum.get_url}}">{{forum.title}}</a></h1>
                  <p>{{forum.description}}</p>
              </div>
              <div class="subforum-stats subforum-column center">
                  <span>{{forum.num_posts}} Posts</span>
              </div>
              <div class="subforum-info subforum-column">
                  <b><a href="{{forum.last_post.get_url}}">Last Post</a></b> by <a href="">{{forum.last_post.user.fullname|title}}</a>
                  <br>
                  on <small>{{forum.last_post.created_at|date:"F d, Y H:i"}}</small>
              </div>
          </div>
          {% endfor %}

      </div>

  </div>

   <!-- Forum Info -->
<div class="forum-info">
  <div class="chart">
      Forum Statistic &nbsp;<i class="fa fa-bar-chart"></i>
  </div>
  <span><u>{{num_posts}}</u> Posts in <u>{{num_categories}}</u> Categories by <u>{{num_users}}</u> Members.</span><br>
  {% if forums %}
      <span>Latest post: <b><a href="{{last_post.get_url}}">{{last_post.title}}</a></b> on {{last_post.date|date}} By <a href="">{{last_post.user.fullname|title}}</a></span>.<br>
      <span>Check <a href="{% url 'latest_posts' %}">the latest posts</a> .</span><br>
  {% endif %}
</div>

</div>
</div>
<!--ends forum-->

      <!--Sciences content-->
      <div class="sciences">
        
        <h1>{{Anemochory_Title}}</h1>
        <img src="{% static 'assets\sciences\anemochory.jpg' %}"><br>
        <h4>{{Anemochory_Verse}}</h4><br>
        <p>وَأَرْسَلْنَا ٱلرِّيَـٰحَ لَوَٰقِحَ فَأَنزَلْنَا مِنَ ٱلسَّمَآءِ مَآءًۭ فَأَسْقَيْنَـٰكُمُوهُ وَمَآ أَنتُمْ لَهُۥ بِخَـٰزِنِينَ ٢٢</p>
        <p>{{Anemochory_Translation}}</p>
        <br>
        <h4>{{Anemochory_Insight}}</h4><br>
        <p>{{Anemochory_Science}}</p><br>
        <p>{{Anemochory_Sciencept2}}</p>  
      </div>
        <div class="reference">
        <h4>References:</h4>
          <p>Mauseth, James D.Botany: An Introduction to Plant Biology.</p>
          <p>Publisher: Jones & Bartlett, 2008</p>
          <p>Siri Al-Quran Mendahului Sains (n.d)</p>
        </div>

<script>
  function on() {
    document.getElementById("overlay").style.display = "block";
  }
  
  function off() {
    document.getElementById("overlay").style.display = "none";
  }
  function toggleBookmark(element, slug) {
    // Check if user is authenticated
    const isAuthenticated = document.body.getAttribute('data-user-authenticated') === 'true';

    if (!isAuthenticated) {
        window.location.href = '/account/signin/'; // Redirect to sign-in page
        return;
    }

    // Proceed with bookmark toggle for authenticated users
    fetch(`/toggle_bookmark/${slug}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'), // Function to get CSRF token
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 'slug': slug })
    })
    .then(response => response.json())
    .then(data => {
        if (data.bookmarked) {
            element.classList.remove('fa-regular');
            element.classList.add('fa-solid');
        } else {
            element.classList.remove('fa-solid');
            element.classList.add('fa-regular');
        }
    })
    .catch(error => console.error('Error:', error));
}

// Function to get CSRF token from cookies
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
document.addEventListener("DOMContentLoaded", function() {
    // Assuming the user is authenticated; adjust as needed
    updateUserBookmarkIcons();
});

function updateUserBookmarkIcons() {
    fetch('/get_user_bookmarks/', { // Adjusted to the correct path
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            // Include CSRF token if needed for GET requests or ensure your view is exempt
        },
    })
    .then(response => response.json())
    .then(data => {
        const bookmarkedSlugs = data.bookmarkedSlugs;
        bookmarkedSlugs.forEach(slug => {
            const bookmarkIcon = document.querySelector(`i[data-slug="${slug}"]`);
            if (bookmarkIcon) {
                bookmarkIcon.classList.remove('fa-regular');
                bookmarkIcon.classList.add('fa-solid');
            }
        });
    })
    .catch(error => console.error('Error:', error));
}
  </script>

<script src="{% static 'js/trialforum.js' %}"></script>   
{% endblock content %}