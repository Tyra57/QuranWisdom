{% extends 'base.html' %}
{% load static %}
  {% block title %}
    <title>Mercy</title>
    <link rel="stylesheet" href="{% static 'css\main.css' %}">
    <link rel="stylesheet" href="{% static 'css\nav.css' %}">
    <link rel="stylesheet" href="{% static 'css\scroll.css' %}">
    <link rel="stylesheet" href="{% static 'css\forum.css' %}">
    <link rel="stylesheet" href="{% static 'css\duacontent.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .dua-content-container{ 
          padding: 50px 100px 50px 100px;
          position:relative;
          width: auto;
          display: flex;
          justify-content: center;
          align-items: center;
          flex-wrap: wrap;
          margin-top: 1%;
        }
        .dua-content-container .card-dua{
          width: 380px;
          background:#f0f0f0;
          margin: 5px 17px;
          padding: 30px 15px;
          display: flex;
          flex-direction: column;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
          transition: 0.3s ease-in-out;
          margin-top: 4%;
          border-radius: 10px;
        }
        .dua-list{
          display: flex;
          flex-direction: column;
        }
      .card-dua{
        justify-content: center;
        height:435px;
        display: flex;
      }
      /*mobile view*/
      @media screen and (max-width: 768px){
        .dua-content-container{
          flex-direction: column;
          padding: 20px; /* Adjust padding for mobile */
        }
        .card-dua{
          width: 100%; /* Full width for mobile view */
          margin: 10px 0; /* Adjust margin for spacing between cards */
          height: auto;
        }
        .nav-to-right, .nav-line{
        margin-left: 20px;
      }
      .nav-link{
        margin-left: 20px;
        margin-right: 0;
      }
      }
    </style>
{% endblock title %}
{% block content %}  
<!--nav link-->
<div class="nav-link">
  <div class="nav-link-content">
    <a href="{% url 'home' %}"><i class="fa-solid fa-house"></i></a>
    <i class="fa-solid fa-chevron-right"></i>
    <p> <a href="{% url 'doa' %}"> Dua' </a><span><i class="fa-solid fa-chevron-right"></i></span> Mercy</p>
  </div> 
</div>
<hr class ="nav-line">
<br>
<!--bookmark and comment-->
<div class="nav-to-right">
  <div class="nav-to-right-content">
    <p><i class="fa-regular fa-bookmark fa-2x" onclick="toggleBookmark(this, 'Doa-Mercy')" data-slug="Doa-Mercy"></i></p>
    <button onclick="on()">See Discussion <i class="fa-regular fa-comment"></i></button>
  </div>
</div>

<!--Forum Section-->
<div class="overlay" id="overlay">
  <div class="container">
      <div class="close">
          <div class="close-button">
              <i class="fas fa-times" onclick="off()"></i>
          </div>         
          <div class="subforum">

          <!--Subforum search
          <form action="" role="form" method="GET">
              <div class="search-box">
                  <div>
                      <select name="search-box" id="">
                      <option value="Everything">Everything</option>
                      <option value="Titles">Titles</option>
                      <option value="Descriptions">Descriptions</option>
                      </select>
                      <input type="text" name="q" placeholder="Search">
                      <button type="submit" name="search"><i class="fas fa-search"></i></button>
                  </div>
              </div>
          </form>-->

          {% if user.is_authenticated %}
            <div class ="create-post">
              <button style="color:#38444d"><a href="{% url 'create_post' %}">Create Post</a></button>
            </div>
          {% endif %}

          <div class="subforum-title">
              <h1>Forum</h1>
          </div>

          {% for forum in forums %}
          <div class="subforum-row">
              <!--<div class="subforum-icon subforum-column center">
                  <i class="fas fa-user"></i>
              </div>-->
              <div class="subforum-description subforum-column">
                  <h1><a href="{{forum.get_url}}">{{forum.title}}</a></h1>
                  <p>{{forum.description}}</p>
              </div>
              <div class="subforum-stats subforum-column center">
                  <span>{{forum.num_posts}} Posts</span>
              </div>
              <div class="subforum-info subforum-column">
                  <b><a href="{{forum.last_post.get_url}}">Last Post</a></b> by <a href="">{{forum.last_post.user.fullname|title}}</a>
                  <br>
                  on <small>{{forum.last_post.created_at|date:"F d, Y H:i"}}</small>
              </div>
          </div>
          {% endfor %}

      </div>

  </div>

   <!-- Forum Info -->
<div class="forum-info">
  <div class="chart">
      Forum Statistic &nbsp;<i class="fa fa-bar-chart"></i>
  </div>
  <span><u>{{num_posts}}</u> Posts in <u>{{num_categories}}</u> Categories by <u>{{num_users}}</u> Members.</span><br>
  {% if forums %}
      <span>Latest post: <b><a href="{{last_post.get_url}}">{{last_post.title}}</a></b> on {{last_post.date|date}} By <a href="">{{last_post.user.fullname|title}}</a></span>.<br>
      <span>Check <a href="{% url 'latest_posts' %}">the latest posts</a> .</span><br>
  {% endif %}
</div>

<script src="{% static 'js/trialforum.js' %}"></script>           

</div>
</div>
<!--ends forum-->

      <!--Doa content-->
      <div class="dua-content-container" style="margin-bottom: 50px;">
 
          <div class="card-dua">
            
            <div class ="dua-list">
              <p class="ayah">رَبَّنَا وَٱجْعَلْنَا مُسْلِمَيْنِ لَكَ وَمِن ذُرِّيَّتِنَآ أُمَّةًۭ مُّسْلِمَةًۭ لَّكَ وَأَرِنَا مَنَاسِكَنَا وَتُبْ عَلَيْنَآ ۖ إِنَّكَ أَنتَ ٱلتَّوَّابُ ٱلرَّحِيمُ ١٢٨</p>
              <p class="translation">Our Lord! Make us both ˹fully˺ submit to You and from our descendants a nation that will submit to You. Show us our rituals, and turn to us in grace. You are truly the Accepter of Repentance, Most Merciful.</p>
              <p class="verse">Al-Baqarah verse 128</p>
            </div>
          </div>

          <div class="card-dua">
            <div class ="dua-list">
              <p class="ayah">لَا يُكَلِّفُ ٱللَّهُ نَفْسًا إِلَّا وُسْعَهَا ۚ لَهَا مَا كَسَبَتْ وَعَلَيْهَا مَا ٱكْتَسَبَتْ ۗ رَبَّنَا لَا تُؤَاخِذْنَآ إِن نَّسِينَآ أَوْ أَخْطَأْنَا ۚ رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَآ إِصْرًۭا كَمَا حَمَلْتَهُۥ عَلَى ٱلَّذِينَ مِن قَبْلِنَا ۚ رَبَّنَا وَلَا تُحَمِّلْنَا مَا لَا طَاقَةَ لَنَا بِهِۦ ۖ وَٱعْفُ عَنَّا وَٱغْفِرْ لَنَا وَٱرْحَمْنَآ ۚ أَنتَ مَوْلَىٰنَا فَٱنصُرْنَا عَلَى ٱلْقَوْمِ ٱلْكَـٰفِرِينَ ٢٨٦</p>
              <p class="translation">Allah does not require of any soul more than what it can afford. All good will be for its own benefit, and all evil will be to its own loss. ˹The believers pray,˺ “Our Lord! Do not punish us if we forget or make a mistake. Our Lord! Do not place a burden on us like the one you placed on those before us. Our Lord! Do not burden us with what we cannot bear. Pardon us, forgive us, and have mercy on us. You are our ˹only˺ Guardian. So grant us victory over the disbelieving people.”</p>
              <p class="verse">Al-Baqarah verse 286</p>
            </div>
          </div>

          <div class="card-dua">
            <div class ="dua-list">
              <p class="ayah">رَبَّنَا لَا تُزِغْ قُلُوبَنَا بَعْدَ إِذْ هَدَيْتَنَا وَهَبْ لَنَا مِن لَّدُنكَ رَحْمَةً ۚ إِنَّكَ أَنتَ ٱلْوَهَّابُ ٨ رَبَّنَآ إِنَّكَ جَامِعُ ٱلنَّاسِ لِيَوْمٍۢ لَّا رَيْبَ فِيهِ ۚ إِنَّ ٱللَّهَ لَا يُخْلِفُ ٱلْمِيعَادَ ٩</p>
              <p class="translation">˹They say,˺ “Our Lord! Do not let our hearts deviate after you have guided us. Grant us Your mercy. You are indeed the Giver ˹of all bounties˺. Our Lord! You will certainly gather all humanity for the ˹promised˺ Day—about which there is no doubt. Surely Allah does not break His promise.”</p>
              <p class="verse">Ali-Imran verse 8-9</p>
            </div>
          </div>

          <div class="card-dua">
            <div class ="dua-list">
              <p class="ayah">قَالَا رَبَّنَا ظَلَمْنَآ أَنفُسَنَا وَإِن لَّمْ تَغْفِرْ لَنَا وَتَرْحَمْنَا لَنَكُونَنَّ مِنَ ٱلْخَـٰسِرِينَ ٢٣</p>
              <p class="translation">They replied, “Our Lord! We have wronged ourselves. If You do not forgive us and have mercy on us, we will certainly be losers.”</p>
              <p class="verse">Al-A’raf verse 23</p>
            </div>
          </div>

          <div class="card-dua">
            <div class ="dua-list">
              <p class="ayah">إِذْ أَوَى ٱلْفِتْيَةُ إِلَى ٱلْكَهْفِ فَقَالُوا۟ رَبَّنَآ ءَاتِنَا مِن لَّدُنكَ رَحْمَةًۭ وَهَيِّئْ لَنَا مِنْ أَمْرِنَا رَشَدًۭا ١٠</p>
              <p class="translation">˹Remember˺ when those youths took refuge in the cave, and said, “Our Lord! Grant us mercy from Yourself and guide us rightly through our ordeal.”</p>
              <p class="verse">Al-Kahf verse 10</p>
            </div>
          </div>

          <div class="card-dua">
            <div class ="dua-list">
              <p class="ayah">وَقُل رَّبِّ ٱغْفِرْ وَٱرْحَمْ وَأَنتَ خَيْرُ ٱلرَّٰحِمِينَ ١١٨</p>
              <p class="translation">Say, ˹O Prophet,˺ “My Lord! Forgive and have mercy, for You are the best of those who show mercy.”</p>
              <p class="verse">Al-Mu’minun verse 118</p>
            </div>
          </div>

          <div class="card-dua">
            <div class ="dua-list">
              <p class="ayah">وَٱلَّذِينَ يَقُولُونَ رَبَّنَا ٱصْرِفْ عَنَّا عَذَابَ جَهَنَّمَ ۖ إِنَّ عَذَابَهَا كَانَ غَرَامًا ٦٥ إِنَّهَا سَآءَتْ مُسْتَقَرًّۭا وَمُقَامًۭا ٦٦</p>
              <p class="translation">˹They are˺ those who pray, “Our Lord! Keep the punishment of Hell away from us, for its punishment is indeed unrelenting. It is certainly an evil place to settle and reside.”</p>
              <p class="verse">Al-Furqan verse 65-66</p>
            </div>
          </div>

          <div class="card-dua">
            <div class ="dua-list">
              <p class="ayah">رَبَّنَا لَا تَجْعَلْنَا فِتْنَةًۭ لِّلَّذِينَ كَفَرُوا۟ وَٱغْفِرْ لَنَا رَبَّنَآ ۖ إِنَّكَ أَنتَ ٱلْعَزِيزُ ٱلْحَكِيمُ ٥</p>
              <p class="translation">Our Lord! Do not subject us to the persecution of the disbelievers. Forgive us, our Lord! You ˹alone˺ are truly the Almighty, All-Wise.”</p>
              <p class="verse">Al-Mumtahanah verse 5</p>
            </div>
          </div>
        </div>
          

        <script>
          function on() {
              document.getElementById("overlay").style.display = "block";
            }
            
            function off() {
              document.getElementById("overlay").style.display = "none";
            }
            function toggleBookmark(element, slug) {
              // Check if user is authenticated
              const isAuthenticated = document.body.getAttribute('data-user-authenticated') === 'true';
          
              if (!isAuthenticated) {
                  window.location.href = '/account/signin/'; // Redirect to sign-in page
                  return;
              }
          
              // Proceed with bookmark toggle for authenticated users
              fetch(`/toggle_bookmark/${slug}/`, {
                  method: 'POST',
                  headers: {
                      'X-CSRFToken': getCookie('csrftoken'), // Function to get CSRF token
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ 'slug': slug })
              })
              .then(response => response.json())
              .then(data => {
                  if (data.bookmarked) {
                      element.classList.remove('fa-regular');
                      element.classList.add('fa-solid');
                  } else {
                      element.classList.remove('fa-solid');
                      element.classList.add('fa-regular');
                  }
              })
              .catch(error => console.error('Error:', error));
          }
          
          // Function to get CSRF token from cookies
          function getCookie(name) {
              let cookieValue = null;
              if (document.cookie && document.cookie !== '') {
                  const cookies = document.cookie.split(';');
                  for (let i = 0; i < cookies.length; i++) {
                      const cookie = cookies[i].trim();
                      if (cookie.substring(0, name.length + 1) === (name + '=')) {
                          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                          break;
                      }
                  }
              }
              return cookieValue;
          }
          document.addEventListener("DOMContentLoaded", function() {
              // Assuming the user is authenticated; adjust as needed
              updateUserBookmarkIcons();
          });
          
          function updateUserBookmarkIcons() {
              fetch('/get_user_bookmarks/', { // Adjusted to the correct path
                  method: 'GET',
                  headers: {
                      'Content-Type': 'application/json',
                      // Include CSRF token if needed for GET requests or ensure your view is exempt
                  },
              })
              .then(response => response.json())
              .then(data => {
                  const bookmarkedSlugs = data.bookmarkedSlugs;
                  bookmarkedSlugs.forEach(slug => {
                      const bookmarkIcon = document.querySelector(`i[data-slug="${slug}"]`);
                      if (bookmarkIcon) {
                          bookmarkIcon.classList.remove('fa-regular');
                          bookmarkIcon.classList.add('fa-solid');
                      }
                  });
              })
              .catch(error => console.error('Error:', error));
          }
            </script>
          
          {% endblock content %}