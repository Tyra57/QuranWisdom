{% extends 'base.html' %}
{% load static %}


  {% block title %}
    <title>Barsisa The Worshipper (The Renegade)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
    <link rel="shortcut icon" href="{% static 'assets\logo\icon3.svg' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'css\main.css' %}">
    <link rel="stylesheet" href="{% static 'css\nav.css' %}">
    <link rel="stylesheet" href="{% static 'css\scroll.css' %}">
    <link rel="stylesheet" href="{% static 'css\forum.css' %}">
    <link rel="stylesheet" href="{% static 'css\storycontent.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @media screen and (max-width: 768px) {
      .nav-to-right, .nav-line{
        margin-left: 20px;
      }
      .nav-link{
        margin-left: 20px;
        margin-right: 0;
      }
    }
</style>
{% endblock title %}
  {% block content %}  

<!--nav link-->
<div class="nav-link">
  <div class="nav-link-content">
    <a href="{% url 'home' %}"><i class="fa-solid fa-house"></i></a>
    <i class="fa-solid fa-chevron-right"></i>
    <p> <a href="{% url 'story' %}"> Story </a><span><i class="fa-solid fa-chevron-right"></i></span> Barsisa The Worshipper (The Renegade)</p>
  </div> 
</div>
<hr class ="nav-line">
<br>
<!--bookmark and comment-->
<div class="nav-to-right">
  <div class="nav-to-right-content">
    <p><i class="fa-regular fa-bookmark fa-2x" onclick="toggleBookmark(this, 'Story-Barsisa-The-Worshipper')" data-slug="Story-Barsisa-The-Worshipper"></i></p>
    <button onclick="on()">See Discussion <i class="fa-regular fa-comment"></i></button>
  </div>
</div>

 <!--Forum Section-->
<div class="overlay" id="overlay">
    <div class="container">
        <div class="close">
            <div class="close-button">
                <i class="fas fa-times" onclick="off()"></i>
            </div>         
            <div class="subforum">
  
            {% if user.is_authenticated %}
              <div class ="create-post">
                <button style="color:#38444d"><a href="{% url 'create_post' %}">Create Post</a></button>
              </div>
            {% endif %}
  
            <div class="subforum-title">
                <h1>Forum</h1>
            </div>
  
            {% for forum in forums %}
            <div class="subforum-row">
                <!--<div class="subforum-icon subforum-column center">
                    <i class="fas fa-user"></i>
                </div>-->
                <div class="subforum-description subforum-column">
                    <h1><a href="{{forum.get_url}}">{{forum.title}}</a></h1>
                    <p>{{forum.description}}</p>
                </div>
                <div class="subforum-stats subforum-column center">
                    <span>{{forum.num_posts}} Posts</span>
                </div>
                <div class="subforum-info subforum-column">
                    <b><a href="{{forum.last_post.get_url}}">Last Post</a></b> by <a href="">{{forum.last_post.user.fullname|title}}</a>
                    <br>
                    on <small>{{forum.last_post.created_at|date:"F d, Y H:i"}}</small>
                </div>
            </div>
            {% endfor %}
  
        </div>
  
    </div>
  
     <!-- Forum Info -->
  <div class="forum-info">
    <div class="chart">
        Forum Statistic &nbsp;<i class="fa fa-bar-chart"></i>
    </div>
    <span><u>{{num_posts}}</u> Posts in <u>{{num_categories}}</u> Categories by <u>{{num_users}}</u> Members.</span><br>
    {% if forums %}
        <span>Latest post: <b><a href="{{last_post.get_url}}">{{last_post.title}}</a></b> on {{last_post.date|date}} By <a href="">{{last_post.user.fullname|title}}</a></span>.<br>
        <span>Check <a href="{% url 'latest_posts' %}">the latest posts</a> .</span><br>
    {% endif %}
  </div>
  
  <script src="{% static 'js/trialforum.js' %}"></script>           
  
  </div>
  </div>
  <!--ends forum-->

<!--image content parallax-->
<div class="parallax" style="background-image:linear-gradient(rgba(0,0,0,0.3),rgba(0,0,0,0.5)), url(https://images.unsplash.com/photo-1606103836293-0a063ee20566?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D);">
  <h1>Barsisa The Worshipper (The Renegade)</h1>
</div>

<style>
  .sidenav{
    width: 200px;
    position: fixed;
    height: 100%;
    left: 0;
    top: 806px;
    z-index: 2;
    overflow-x: hidden;
  }
  .sidenav a{
    padding: 10px 0px 10px 30px;
    text-decoration: none;
    font-size: 14px;
    color: #38444d;
    display: block;
  }
  .sidenav a:hover{
    color: #004085;
  }
  .story1{ 
    padding: 50px 150px 100px 60px;
    margin-left: 200px;
    align-items: center;
    text-align: justify;
  }
  .story1 .h4{
    text-align: center;
  }
  .story1 .p{
    text-align: justify;
  }

  hr .line{
    border: 0;
    height: 2px;
    width: 100%;
    margin: 15px 0 10px;
  }
.toggle-story {
  display: none;
}
  /* Adjustments for mobile view */
  @media screen and (max-width: 768px) {
    .sidenav {
      display: none;
    }
  /* Adjust content padding to not overlap with the sidenav */
  .story1 {
    padding: 20px;
    margin-bottom: 60px; /* Add space at the bottom for sidenav */
    margin-left: 0;
  }
}
</style>

    <div class="sidenav" id="sidenav"> 
    
      <a href="#">Introduction</a>
      <a href="#">The Deception of Satan</a>
      <a href="#">The Fall</a>
      <a href="#">The Dream and the King's Justice</a>
      <a href="#">The Final Temptation and Punishment</a>
      <a href="#">A Lesson on Faith and Deception</a>
      <a href="#">References</a>
     
    </div>


      <!--Story of Luqman content-->
      <div class="story1">

        <!--<h1>Story of Luqman</h1>
        <img src="assets\story\storyofluqman.jpg" width="600" height="345"><br>-->
        <h4>Introduction to Barsisa The Worshipper (The Renegade)</h4>
        <br>
        <p>كَمَثَلِ ٱلشَّيْطَـٰنِ إِذْ قَالَ لِلْإِنسَـٰنِ ٱكْفُرْ فَلَمَّا كَفَرَ قَالَ إِنِّى بَرِىٓءٌۭ مِّنكَ إِنِّىٓ أَخَافُ ٱللَّهَ رَبَّ ٱلْعَـٰلَمِينَ ١٦ فَكَانَ عَـٰقِبَتَهُمَآ أَنَّهُمَا فِى ٱلنَّارِ خَـٰلِدَيْنِ فِيهَا ۚ وَذَٰلِكَ جَزَٰٓؤُا۟ ٱلظَّـٰلِمِينَ ١٧</p>
        <br>
        {(Their allies deceived them) like Shaitan (Satan), when he says to man: "Disbelieve in Allah." But when (man) disbelieves in Allah, Shaitan (Satan) says: "I am free of you, I fear Allah, the Lord of the `Alamin (mankind, jinn and all that exists)!" So the end of both will be that they will be in the Fire, abiding therein. Such is the recompense of the Zalimun (i.e. polytheists, wrongdoers, disbelievers in Allah and in His Oneness)}. (Al-Hashr, 16, 17)
        <br><br>
        <hr class ="line">
        <br>
        <h4>The Deception of Satan</h4>
        <br>
        Ibn Jarir said that 'Abdullah Ibn Mas'ud interpreted the Qur'anic Verse that reads: {(Their allies deceived them) like Shaitan (Satan), when he says to man: "Disbelieve in Allah." But when (man) disbelieves in Allah, Shaitan (Satan) says: "I am free of you, I fear Allah, the Lord of the 'Alamin (mankind, jinn and all that exists)!" So the end of both will be that they will be in the Fire, abiding therein. Such is the recompense of the Zalimun (i.e. polytheists, wrong-doers, disbelievers in Allah and in His Oneness)}. (Al-Hashr, 16, 17)
        <br><br>
        <hr class ="line">
        <br>
        <h4>The Fall</h4>
        <br>
        Ibn Masud (May Allah be pleased with him) said: Once upon a time, there was a woman grazing sheep and goats. She had four brothers. She (for some reason) used to spend the night at a monk's cell. The monk committed adultery with her and she got pregnant. Satan came to him and said: Kill the woman and then bury her for you are a reputable and highly respected man (i.e. don't risk your own reputation for such a simple woman). The monk killed her and then buried her. 
        <br><br>
        <hr class ="line">
        <br>
        <h4>The Dream and the King's Justice</h4>
        <br>
        Thereupon, Satan visited her four brothers in a dream while they were asleep and said to them: the monk committed adultery with your sister, and because she got pregnant, he killed her and buried her in such-and-such location. In the morning, one of them said: "By Allah! Last night I dreamt of something and I do not know whether to relate it to you or just keep it to myself?" They said: Relate it to us. He did so and one of them said: By Allah! I saw the same dream.
        Another said the same. And the fourth one said the same thing. They agreed on that there must be something serious about that dream. They went to the king and appealed for his help against the monk. The king's troops came to arrest him and he was taken away. 
        <br><br>
        <hr class ="line">
        <br>
        <h4>The Final Temptation and Punishment</h4>
        <br>
        On the way, Satan came to the monk (and whispered in his ears): I set you up. No one else can save you from this. Prostrate yourself before me just for once and in return, I will save you from this. Thereupon, the monk prostrated himself before Satan. When they presented themselves before the king, Satan said to him: I am free of you! Finally, the monk was killed.
        <br><br>
        <hr class ="line">
        <br>
        <h4>A Lesson on Faith and Deception</h4>
        <br>
        The same story was narrated by the Leader of the Believers, Ali Ibn Abu Talib (May Allah be pleased with him) in another wording. Ibn Jarir said: I was told by Khallad Ibn Aslam, on the authority of An-Nadr Ibn Shamil after Shu'bah, after Abu Ishaq, after Abdullah Ibn Nahik saying: I heard 'Ali as saying: A monk worshipped Allah Alone for sixty years. Satan exerted himself to seduce him, but could not. He went to a woman and touched her with evil (maddened her). The woman had brothers whom were visited by Satan who told them to take her to that monk to receive treatment and cure. They took her to the monk and he treated her. Afterwards, she stayed for a while at his cell (house). One day, he was attracted to her and he committed adultery with her. She got pregnant and he killed her (to conceal his first crime). Her brothers came (after knowing the matter) and Satan appeared again for the monk and said: I am your friend, I did not find a solution or way to mislead you, but (finally) I set you up. So, obey me and I will save you from this. Prostrate yourself before me and you will be saved. The monk did so. Then, Satan said: {"I am free of you, I fear Allah, the Lord of the Alamin (mankind, jinn and all that exists)! "} . (Al-Hashr ,16)
        This is the interpretation of Allah's Saying: {(Their allies deceived them) like Shaitan (Satan), when he says to man: "Disbelieve in Allah." But when (man) disbelieves in Allah, Shaitan (Satan) says: "I am free of you, I fear Allah, the Lord of the" Alamin (mankind, jinn and all that exists)!" So the end of both will be that they will be in the Fire, abiding therein. Such is the recompense of the Zalimun (i.e. polytheists, wrong-doers, disbelievers in Allah and in His Oneness)}. (Al-Hashr, 16, 17)
        <br><br>
        <hr class ="line">
        <br>
        <h4 class="ref">References:</h4>
          <p class ="ref">Stories of The Quran, by Ibn Kathir</p>
      </div>

      
   
<script>
function toggleSidenav() {
  var sidenav = document.getElementById("sidenav");
  if (sidenav.style.display === "block") {
    sidenav.style.display = "none";
  } else {
    sidenav.style.display = "block";
  }
}
</script>
<script>
  function on() {
    document.getElementById("overlay").style.display = "block";
  }
  
  function off() {
    document.getElementById("overlay").style.display = "none";
  }
  function toggleBookmark(element, slug) {
    // Check if user is authenticated
    const isAuthenticated = document.body.getAttribute('data-user-authenticated') === 'true';

    if (!isAuthenticated) {
        window.location.href = '/account/signin/'; // Redirect to sign-in page
        return;
    }

    // Proceed with bookmark toggle for authenticated users
    fetch(`/toggle_bookmark/${slug}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'), // Function to get CSRF token
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 'slug': slug })
    })
    .then(response => response.json())
    .then(data => {
        if (data.bookmarked) {
            element.classList.remove('fa-regular');
            element.classList.add('fa-solid');
        } else {
            element.classList.remove('fa-solid');
            element.classList.add('fa-regular');
        }
    })
    .catch(error => console.error('Error:', error));
}

// Function to get CSRF token from cookies
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
document.addEventListener("DOMContentLoaded", function() {
    // Assuming the user is authenticated; adjust as needed
    updateUserBookmarkIcons();
});

function updateUserBookmarkIcons() {
    fetch('/get_user_bookmarks/', { // Adjusted to the correct path
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            // Include CSRF token if needed for GET requests or ensure your view is exempt
        },
    })
    .then(response => response.json())
    .then(data => {
        const bookmarkedSlugs = data.bookmarkedSlugs;
        bookmarkedSlugs.forEach(slug => {
            const bookmarkIcon = document.querySelector(`i[data-slug="${slug}"]`);
            if (bookmarkIcon) {
                bookmarkIcon.classList.remove('fa-regular');
                bookmarkIcon.classList.add('fa-solid');
            }
        });
    })
    .catch(error => console.error('Error:', error));
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
$(document).ready(function() {
  var initialTop = $('.sidenav').css('top'); // Store the initial top value
  $(window).scroll(function() {
    var scroll = $(window).scrollTop(); // Get current scroll position
    $('.sidenav').css('top', Math.max(0, parseInt(initialTop) - scroll)); // Adjust top based on scroll
  });
});
</script>
{% endblock content %}