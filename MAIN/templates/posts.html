{% extends 'base.html' %}
{% load static %}
{% load hitcount_tags %}
{% block title %}
    <title>Post Forum</title>
    <link rel="stylesheet" href="{% static 'css\main.css' %}">
    <link rel="stylesheet" href="{% static 'css\nav.css' %}">
    <link rel="stylesheet" href="{% static 'css\forum.css' %}">
    <link rel="stylesheet" href="{% static 'css\scroll.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        html, body {
    margin: 0;
    padding: 0;
    min-height: 100vh; /* Full viewport height */
    display: flex;
    flex-direction: column;
}

.container-post {
    flex: 1; /* Ensures content takes up the necessary space */
}
    </style>
    {% endblock title %}

    {% block content %}   
    <!--Forum Section-->
        <div class="container-post">
            <!--navigation-->
            <div class="forum-navigate">
                <span><!--<a href="#" onclick="goToLastVisitedPage()">--><a href ="{% url 'home' %}">Home</a> >> <a href="{{forum.get_url}}">{{forum.title}}</a></span>
            </div>
                <div class="posts-table">
                  <div class="table-head">
                    <div class="status">User</div>
                    <div class="subjects">Subjects</div>
                    <div class="replies">Replies/Views</div>
                    <div class="last-reply">Last Reply</div>
                  </div>
                  {% for post in posts %}
                  <div class="table-row">
                    <div class="status">
                        <a href=""><i class="fas fa-user"></i></a>
                    </div>
                    <div class="subjects">
                        <a href="{{post.get_url}}">{{post.title}}</a> <br>
                        <span>Started by<b><a href="#"> {{post.user.fullname|title}}</a></b>.</span>
                    </div>
                    <div class="replies">
                        {{post.num_comments}} comments <br>{% get_hit_count for post %} views
                    </div>
                    <div class="last-reply">
                        {{post.last_reply.created_at|date:"F d, Y H:i"}}
                        <br>
                        By <b><a href="#">{{post.last_reply.user.fullname|title}}</a></b>
                    </div>
                  </div>
                  {% endfor %}
                </div>
            
            <!--Pagination starts-->
            {% if posts.is_paginated %}
            <div class="pagination">
                pages: {% for num_page in posts.paginator.page_range %} <a href="?page={{num_page}}">{{num_page}}</a> {% endfor %}
            </div>
             {% endif %}
             <!--pagination ends-->
        </div>
            <!--Status note
            <div class="status-note">
                <i class="fas fa-frown"></i> - 0 Engagement Topic <br>
                <i class="fas fa-rocket"></i> - High Engagement Topic <br>
                <i class="fas fa-book"></i> - Low Engagement Topic <br>
                <i class="fas fa-fire"></i> - Popular Topic <br>
                <i class="fas fa-lock"></i> - Closed Topic <br>
            </div>-->

        <script>
                function goToLastVisitedPage() {
                const lastPage = sessionStorage.getItem('lastVisitedPage');
                if (lastPage) {
                    window.location.href = lastPage;
                } else {
                    window.location.href = "{% url 'home' %}"; // Fallback to home if no last page stored
                }
            }
        </script>
        <script src="{% static 'js/trialforum.js' %}"></script>  
{% endblock content %}